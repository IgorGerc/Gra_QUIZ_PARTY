name: Build Quiz Party APK

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Kod ÅºrÃ³dÅ‚owy
      - uses: actions/checkout@v4

      # 2. Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      # 3. Java - prostsze niÅ¼ instalacja przez APT
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      # 4. PozostaÅ‚e zaleÅ¼noÅ›ci systemowe (bez libtinfo5)
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y git zip unzip autoconf libtool pkg-config \
              zlib1g-dev libncurses5-dev libncursesw5-dev \
              cmake libffi-dev libssl-dev

      # 5. Python dependencies
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install buildozer cython

      # 6. Budowanie APK
      - name: Build APK with Buildozer
        run: |
          yes | buildozer android debug

      # 7. Artefakt - v4
      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: quiz-party-apk
          path: bin/*.apk

      # 8. GitHub Release
      - name: Create Release
        if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0-${{ github.run_number }}
          name: Quiz Party v1.0-${{ github.run_number }}
          body: |
            ğŸ‰ Quiz Party APK â€“ automatycznie zbudowany!
            
            ğŸ“± **Instalacja:**
            1. Pobierz plik APK poniÅ¼ej
            2. WÅ‚Ä…cz â€Å¹rÃ³dÅ‚a nieznane" w ustawieniach telefonu
            3. Kliknij APK i zainstaluj
            4. Gotowe! ğŸš€
            
            ğŸ® **Funkcje:**
            - Gra dla 3â€“10 graczy
            - Tryb demo offline
            - ZarzÄ…dzanie pytaniami
            - Åadny interfejs
            
            ğŸ“¤ **Podziel siÄ™:**
            WyÅ›lij plik APK znajomym przez Messenger/WhatsApp/Drive!
          files: bin/*.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
